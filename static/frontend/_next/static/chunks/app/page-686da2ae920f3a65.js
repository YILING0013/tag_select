(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{8521:(e,t,n)=>{Promise.resolve().then(n.bind(n,7789))},7789:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>N});var l=n(5155),a=n(2115),r=n(9552),i=n(6036),s=n(4665),o=n(2479),c=n(8648),x=n(9987),d=n(8998),u=n(6854),h=n(9030),p=n(8222),f=n(810),g=n(5330),m=n(9234),j=n(7821),A=n(5480);let y=e=>{let[t,n]=a.useState(0),[r,i]=a.useState([]),[y,b]=a.useState([]),[C,v]=a.useState({}),[T,w]=a.useState(!1),[k,S]=a.useState(null),[D,z]=a.useState(null),[_,E]=a.useState(null);a.useEffect(()=>{!async function(){w(!0);try{let e=await fetch("/api/json-files"),t=await e.json();i(t)}catch(e){console.error("Error fetching JSON files:",e)}finally{w(!1)}}()},[]);let q=async e=>{w(!0);try{let t=await fetch("/api/json-files/".concat(e,"/keys")),n=await t.json();b(n)}catch(e){console.error("Error loading JSON keys:",e)}finally{w(!1)}},W=async(e,t)=>{w(!0);try{let n=await fetch("/api/json-files/".concat(e,"/keys/").concat(t)),l=await n.json();v(e=>({...e,[t]:l}))}catch(e){console.error("Error loading JSON key content:",e)}finally{w(!1)}},R=e=>{S(k===e?null:e),C[e]||W(r[t],e)};a.useEffect(()=>{r.length>0&&q(r[0])},[r]);let I=(e,t)=>{e.preventDefault(),E(t),z(e.currentTarget)},O=e=>{e=e.replace(/ /g,"_");let t="https://danbooru.donmai.us/posts?tags=".concat(e);window.open(t,"_blank"),z(null)};return(0,l.jsxs)(s.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:[(0,l.jsxs)(o.A,{sx:{height:"100%",display:"flex",flexDirection:"column",gap:2,p:3,overflow:"auto"},children:[(0,l.jsx)(c.A,{value:t,onChange:(e,t)=>{n(t),v({}),q(r[t])},variant:"scrollable",scrollButtons:"auto",sx:{px:2},children:r.map(e=>(0,l.jsx)(x.A,{label:e.replace(".json","")},e))}),(0,l.jsx)(d.A,{sx:{flex:1,p:2,borderTop:"1px solid",borderColor:"divider",overflowY:"auto"},children:T?(0,l.jsx)(u.A,{}):(0,l.jsx)(l.Fragment,{children:y.length>0?y.map(t=>(0,l.jsxs)(h.A,{expanded:k===t,onChange:()=>R(t),children:[(0,l.jsx)(p.A,{children:(0,l.jsx)(f.A,{variant:"body1",children:t})}),(0,l.jsx)(g.A,{children:(0,l.jsx)(d.A,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:C[t]?Object.entries(C[t]).map(t=>{let[n,a]=t;return(0,l.jsx)(m.A,{label:"".concat(a," (").concat(n,")"),variant:"outlined",size:"small",onClick:()=>{e.onAddTag&&e.onAddTag({cnText:a,originalEnText:n,curlyCount:0,squareCount:0})},onContextMenu:e=>I(e,n)},n)}):(0,l.jsx)(u.A,{size:20})})})]},t)):(0,l.jsx)(f.A,{variant:"body2",children:"请选择一个选项卡"})})})]}),(0,l.jsx)(j.A,{anchorEl:D,open:!!D,onClose:()=>{z(null)},MenuListProps:{"aria-labelledby":"basic-button"},children:(0,l.jsx)(A.A,{onClick:()=>O(_),children:"在Danbooru上预览"})})]})};var b=n(2401),C=n(2282),v=n(6656),T=n(5394),w=n(4616),k=n(2688),S=n(679),D=n(5933);let z=e=>{let{onAddTag:t}=e,[n,r]=a.useState(3),[i,u]=a.useState(""),[h,p]=a.useState([]),[g,m]=a.useState(""),[j,A]=a.useState([]),[y,z]=a.useState(!1),[_,E]=a.useState(""),[q,W]=a.useState(""),[R,I]=a.useState([]),O={flex:1,minHeight:0,overflowY:"auto",p:1,border:"1px solid",borderColor:"divider",borderRadius:1,bgcolor:"background.paper"},H={m:.5,textTransform:"none",fontSize:"0.75rem",py:.25,px:1,color:"text.secondary",borderWidth:1,"&:hover":{borderWidth:1}},N=async()=>{if(!i.trim())return;let e=i.split(",").map(e=>e.trim()).filter(e=>e);try{let t=await fetch("/api/Tagtranslate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({texts:e})});if(!t.ok)throw Error("Translation API error");let n=(await t.json()).translated_texts,l=e.map((e,t)=>({originalEnText:e,cnText:n&&n[t]?n[t]:e,curlyCount:0,squareCount:0}));p(e=>[...e,...l])}catch(n){let t=e.map(e=>({originalEnText:e,cnText:e,curlyCount:0,squareCount:0}));p(e=>[...e,...t])}},P=()=>{p([])},B=e=>{let t=new DOMParser().parseFromString(e,"text/html").querySelectorAll("[data-tag-name]"),n=[];return t.forEach(e=>{let t=e.getAttribute("data-tag-name").replace(/_/g," "),l="true"===e.getAttribute("data-is-deprecated"),a=Array.from(e.querySelectorAll("a")).map(e=>e.textContent.trim()),r=e.querySelector(".post-count"),i=r?r.getAttribute("title"):null;n.push({tag_name:t,is_deprecated:l,links:a,post_count:i})}),n},M=async()=>{if(g.trim()){z(!0);try{console.log("正在获取HTML...");let e=await fetch(g,{method:"GET",mode:"cors",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"}});if(!e.ok)throw Error("HTTP ".concat(e.status,": ").concat(e.statusText));let t=await e.text();console.log("HTML获取成功，开始解析...");let n=B(t);if(console.log("解析到标签数量:",n.length),0===n.length){alert("未找到任何标签，请检查URL是否正确");return}let l=n.map(e=>e.tag_name);console.log("正在翻译标签...");let a=await fetch("/api/Tagtranslate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({texts:l})});if(!a.ok)throw Error("翻译API调用失败");let r=(await a.json()).translated_texts,i=n.map((e,t)=>({originalEnText:e.tag_name,cnText:r&&r[t]?r[t]:e.tag_name,curlyCount:0,squareCount:0,is_deprecated:e.is_deprecated,post_count:e.post_count}));A(e=>[...e,...i]),console.log("标签加载完成")}catch(t){console.error("D站标签加载失败:",t);let e="加载失败: ";"TypeError"===t.name&&t.message.includes("Failed to fetch")?e+="无法访问该网站，可能是CORS跨域问题。请尝试：\n1. 安装CORS浏览器扩展\n2. 使用代理服务\n3. 或者检查网络连接":e+=t.message,alert(e)}finally{z(!1)}}},L=()=>{A([])},U=e=>{let t="/search/".concat(e,"?query=").concat(encodeURIComponent(_));return q.trim()&&(t+="&max_results=".concat(encodeURIComponent(q))),t},Y=async e=>{if(_.trim())try{let t=U(e),n=await fetch(t);if(!n.ok)throw Error("".concat(e," search error"));let l=(await n.json()).map(e=>{let t=Object.keys(e)[0];return{originalEnText:t,cnText:e[t]||t,curlyCount:0,squareCount:0}});I(e=>[...e,...l])}catch(e){console.error(e)}},G=()=>Y("regular_expression"),J=()=>Y("fuzzy_search"),F=()=>Y("exact_search"),K=()=>I([]);return(0,l.jsx)(s.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:(0,l.jsxs)(o.A,{sx:{flex:1,display:"flex",flexDirection:"column",p:0,minHeight:0},children:[(0,l.jsx)(c.A,{value:n,onChange:(e,t)=>{r(t)},variant:"fullWidth",sx:{borderBottom:1,borderColor:"divider"},children:["自定义","D站Tag导入","Tag搜索","关于"].map(e=>(0,l.jsx)(x.A,{label:e},e))}),(0,l.jsx)(d.A,{sx:{flex:1,p:2,overflow:"hidden",display:"flex",flexDirection:"column",gap:2,height:"100%"},children:(e=>{switch(e){case 0:return(0,l.jsxs)(d.A,{sx:{height:"100%",display:"flex",flexDirection:"column",gap:2,p:2},children:[(0,l.jsxs)(d.A,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[(0,l.jsx)(d.A,{sx:{flex:1},children:(0,l.jsx)(b.A,{fullWidth:!0,multiline:!0,minRows:3,maxRows:5,placeholder:"请在此输入你的tag串, tag将按照逗号划分开并添加为页面元素",variant:"outlined",value:i,onChange:e=>u(e.target.value),sx:{"& .MuiInputBase-root":{alignItems:"flex-start",overflow:"auto"}}})}),(0,l.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,l.jsx)(C.A,{variant:"contained",onClick:N,size:"small",children:"加载"}),(0,l.jsx)(C.A,{variant:"outlined",color:"error",onClick:P,size:"small",children:"清空"})]})]}),(0,l.jsx)(d.A,{sx:O,children:h.map((e,n)=>(0,l.jsx)(C.A,{variant:"outlined",size:"small",onClick:()=>t&&t(e),sx:H,children:"".concat(e.cnText," (").concat(e.originalEnText,")")},n))})]});case 1:return(0,l.jsxs)(d.A,{sx:{height:"100%",display:"flex",flexDirection:"column",gap:2,p:2},children:[(0,l.jsxs)(d.A,{sx:{display:"flex",gap:2,alignItems:"flex-start"},children:[(0,l.jsx)(b.A,{fullWidth:!0,multiline:!0,minRows:3,maxRows:4,placeholder:"D站图像网址示例：https://danbooru.donmai.us/posts/114514",variant:"outlined",value:g,onChange:e=>m(e.target.value),sx:{"& .MuiInputBase-root":{alignItems:"flex-start",overflow:"auto"}}}),(0,l.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,l.jsx)(C.A,{variant:"contained",onClick:M,size:"small",disabled:y,children:y?"加载中...":"解析"}),(0,l.jsx)(C.A,{variant:"outlined",color:"error",onClick:L,size:"small",children:"清空"})]})]}),(0,l.jsx)(d.A,{sx:{p:1,bgcolor:"info.light",borderRadius:1},children:(0,l.jsx)(f.A,{variant:"caption",sx:{color:"info.contrastText"},children:"\uD83D\uDCA1 提示：该功能需可访问Danbooru，如遇问题，请安装CORS浏览器扩展或使用代理"})}),(0,l.jsx)(d.A,{sx:O,children:j.map((e,n)=>(0,l.jsx)(C.A,{variant:"outlined",size:"small",onClick:()=>t&&t(e),sx:H,children:"".concat(e.cnText," (").concat(e.originalEnText,")")},n))})]});case 2:return(0,l.jsxs)(d.A,{sx:{height:"100%",display:"flex",flexDirection:"column",gap:2,p:2},children:[(0,l.jsxs)(d.A,{sx:{display:"flex",gap:2,alignItems:"center"},children:[(0,l.jsx)(b.A,{fullWidth:!0,placeholder:"搜索内容（中英文皆可）",value:_,onChange:e=>E(e.target.value)}),(0,l.jsx)(b.A,{placeholder:"返回量",value:q,onChange:e=>W(e.target.value),sx:{width:100}})]}),(0,l.jsxs)(d.A,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[(0,l.jsx)(C.A,{variant:"contained",onClick:G,size:"small",children:"正则"}),(0,l.jsx)(C.A,{variant:"contained",onClick:J,size:"small",children:"模糊"}),(0,l.jsx)(C.A,{variant:"contained",onClick:F,size:"small",children:"精确"}),(0,l.jsx)(C.A,{variant:"outlined",color:"error",onClick:K,size:"small",children:"清空"})]}),(0,l.jsx)(d.A,{sx:O,children:R.map((e,n)=>(0,l.jsx)(C.A,{variant:"outlined",size:"small",onClick:()=>t&&t(e),sx:H,children:"".concat(e.cnText," (").concat(e.originalEnText,")")},n))})]});default:return(0,l.jsxs)(d.A,{sx:{height:"100%",display:"flex",flexDirection:"column",gap:2,p:3,overflow:"auto"},children:[(0,l.jsx)(f.A,{variant:"h5",sx:{fontWeight:600,color:"primary.main",borderBottom:"2px solid",borderColor:"primary.main",pb:1},children:"关于我们"}),(0,l.jsxs)(d.A,{sx:{display:"grid",gridTemplateColumns:{xs:"1fr",md:"1fr 1fr"},gap:3,flexGrow:1},children:[(0,l.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,l.jsxs)(s.A,{variant:"outlined",sx:{p:2},children:[(0,l.jsx)(f.A,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:"网站信息"}),(0,l.jsxs)(f.A,{variant:"body2",sx:{lineHeight:1.6},children:["本平台是",(0,l.jsx)("b",{children:"Xianyun Draw Web"}),"生态的组成部分，提供专业的词条管理服务。 所有服务均免费提供，遵循"," ",(0,l.jsx)(v.A,{href:"https://nai.idlecloud.cc/terms",target:"_blank",rel:"noopener",children:"用户协议"}),"。"]})]}),(0,l.jsxs)(s.A,{variant:"outlined",sx:{p:2},children:[(0,l.jsx)(f.A,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:"开发相关"}),(0,l.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,l.jsxs)(v.A,{href:"https://github.com/YILING0013",target:"_blank",rel:"noopener",sx:{display:"flex",alignItems:"center",gap:1,color:"inherit"},children:[(0,l.jsx)(T.A,{fontSize:"small"})," GitHub 仓库"]}),(0,l.jsxs)(v.A,{href:"https://nai.idlecloud.cc",target:"_blank",rel:"noopener",sx:{display:"flex",alignItems:"center",gap:1,color:"inherit"},children:[(0,l.jsx)(w.A,{fontSize:"small"})," 绘图主站"]})]})]})]}),(0,l.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,l.jsxs)(s.A,{variant:"outlined",sx:{p:2},children:[(0,l.jsx)(f.A,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:"社区互动"}),(0,l.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,l.jsx)(C.A,{variant:"outlined",startIcon:(0,l.jsx)(k.A,{}),href:"http://qm.qq.com/cgi-bin/qm/qr?_wv=1027&k=CdpNbaIcbz34wRENnz51fq4cmn8w97_u&authKey=lWSd%2BdH732ZphzYm6of0vZOq2k16qOUfHTK19kWRaJ73%2BdtcVBzWLHdYcVPo2Z5V&noverify=0&group_code=619176101",target:"_blank",sx:{justifyContent:"flex-start"},children:"加入QQ群"}),(0,l.jsx)(C.A,{variant:"outlined",startIcon:(0,l.jsx)(S.A,{}),href:"https://space.bilibili.com/487156342",target:"_blank",sx:{justifyContent:"flex-start"},children:"Bilibili频道"})]})]}),(0,l.jsx)(s.A,{variant:"outlined",sx:{p:2,background:e=>"light"===e.palette.mode?"linear-gradient(45deg, #ffe9e9 30%, #f6f3ff 90%)":"linear-gradient(45deg, #2a2a2a 30%, #1a1a1a 90%)"},children:(0,l.jsxs)(d.A,{sx:{textAlign:"center"},children:[(0,l.jsx)(f.A,{variant:"subtitle1",sx:{mb:1,fontWeight:500},children:"支持我们"}),(0,l.jsx)(d.A,{sx:{width:80,height:80,margin:"0 auto 16px",background:"url(https://afdian.com/static/img/logo/logo.png) center/contain no-repeat"}}),(0,l.jsx)(C.A,{variant:"contained",color:"secondary",endIcon:(0,l.jsx)(D.A,{}),href:"https://afdian.com/a/lingyunfei",target:"_blank",sx:{borderRadius:20,px:4,textTransform:"none",boxShadow:1,"&:hover":{boxShadow:3}},children:"爱发电赞助"})]})})]})]}),(0,l.jsxs)(f.A,{variant:"caption",sx:{color:"text.secondary",textAlign:"center",mt:2},children:["\xa9 ",new Date().getFullYear()," Xianyun Project. All rights reserved."]})]})}})(n)})]})})};var _=n(1163),E=n(894),q=n(7740),W=n(7881),R=n(450);let I=e=>{let{tag:t,onUpdateTag:n,onDeleteTag:a,useRoundWeightSymbol:r}=e;return(0,l.jsxs)(d.A,{sx:{display:"inline-flex",alignItems:"center",border:"1px solid #ccc",borderRadius:1,p:.5,m:.2,backgroundColor:"#f9f9f9",cursor:"move"},"data-id":t.id,children:[(0,l.jsx)(E.A,{size:"small",sx:{p:.2},onClick:()=>{t.squareCount>0?n({...t,squareCount:t.squareCount-1}):n({...t,curlyCount:t.curlyCount+1})},children:(0,l.jsx)(q.A,{fontSize:"inherit"})}),(0,l.jsx)(E.A,{size:"small",sx:{p:.2},onClick:()=>{t.curlyCount>0?n({...t,curlyCount:t.curlyCount-1}):n({...t,squareCount:t.squareCount+1})},children:(0,l.jsx)(W.A,{fontSize:"inherit"})}),(0,l.jsx)(f.A,{variant:"body2",sx:{mx:.2},children:t.cnText}),(0,l.jsx)(f.A,{variant:"body2",sx:{mx:.5},children:t.curlyCount>0?(r?"(":"{").repeat(t.curlyCount)+t.originalEnText+(r?")":"}").repeat(t.curlyCount):t.squareCount>0?"[".repeat(t.squareCount)+t.originalEnText+"]".repeat(t.squareCount):t.originalEnText}),(0,l.jsx)(E.A,{size:"small",sx:{p:.2},onClick:()=>a(t.id),children:(0,l.jsx)(R.A,{fontSize:"inherit"})})]})},O=e=>{let{tags:t,onUpdateTag:n,onDeleteTag:c,onReorderTags:x,onClearTags:u}=e,[h,p]=a.useState(!1),f=()=>t.map(e=>{if(e.curlyCount>0){let t=h?"(":"{",n=h?")":"}";return t.repeat(e.curlyCount)+e.originalEnText+n.repeat(e.curlyCount)}return e.squareCount>0?"[".repeat(e.squareCount)+e.originalEnText+"]".repeat(e.squareCount):e.originalEnText}).join(", ");return(0,l.jsx)(r.A,{maxWidth:!1,disableGutters:!0,children:(0,l.jsxs)(i.A,{container:!0,spacing:.5,children:[(0,l.jsx)(i.A,{size:{xs:12,md:8},children:(0,l.jsx)(s.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:(0,l.jsx)(o.A,{sx:{flex:1,display:"flex",minHeight:250,flexDirection:"column"},children:(0,l.jsx)(d.A,{sx:{flex:1,p:1,border:"1px dashed grey",borderRadius:1,overflowY:"auto",display:"flex",flexWrap:"wrap"},children:(0,l.jsx)(_.ReactSortable,{list:t,setList:x,tag:"div",options:{animation:150},children:t.map(e=>(0,l.jsx)(I,{tag:e,onUpdateTag:n,onDeleteTag:c,useRoundWeightSymbol:h},e.id))})})})})}),(0,l.jsx)(i.A,{size:{xs:12,md:4},children:(0,l.jsx)(s.A,{sx:{height:"100%",display:"flex",flexDirection:"column"},children:(0,l.jsxs)(o.A,{sx:{flex:1,display:"flex",flexDirection:"column",gap:2},children:[(0,l.jsx)(b.A,{fullWidth:!0,multiline:!0,minRows:5,maxRows:5,placeholder:"这里是调整后的词条输出",value:f(),"aria-readonly":"true"}),(0,l.jsxs)(d.A,{sx:{display:"flex",justifyContent:"space-between",gap:2},children:[(0,l.jsx)(C.A,{variant:"contained",color:"primary",fullWidth:!0,onClick:()=>{let e=f(),t=()=>{let t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")?alert("已复制到剪贴板！"):alert("复制失败")}catch(e){alert("复制失败")}document.body.removeChild(t)};navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(()=>{alert("已复制到剪贴板！")}).catch(()=>{t()}):t()},children:"复制 Copy"}),(0,l.jsx)(C.A,{variant:"contained",color:"error",fullWidth:!0,onClick:u,children:"清空 Clear"}),(0,l.jsx)(C.A,{variant:"contained",color:"info",fullWidth:!0,onClick:()=>{p(e=>!e)},children:"切换加权符号"})]})]})})})]})})};function H(){let[e,t]=(0,a.useState)([]),n=e=>{t(t=>[...t,{...e,id:Date.now().toString()+Math.random().toString()}])};return(0,l.jsxs)(r.A,{maxWidth:!1,disableGutters:!0,sx:{height:"100vh",p:1,display:"flex",flexDirection:"column",gap:.5},children:[(0,l.jsx)(i.A,{container:!0,spacing:.5,children:(0,l.jsx)(i.A,{size:{xs:12,md:12},children:(0,l.jsx)(O,{tags:e,onUpdateTag:e=>{t(t=>t.map(t=>t.id===e.id?e:t))},onDeleteTag:e=>{t(t=>t.filter(t=>t.id!==e))},onReorderTags:e=>{t(e)},onClearTags:()=>{t([])}})})}),(0,l.jsxs)(i.A,{container:!0,spacing:.5,sx:{flex:1,minHeight:{xs:550,sm:0}},children:[(0,l.jsx)(i.A,{size:{xs:12,md:8},sx:{height:"100%"},children:(0,l.jsx)(y,{onAddTag:n})}),(0,l.jsx)(i.A,{size:{xs:12,md:4},sx:{height:"100%"},children:(0,l.jsx)(z,{onAddTag:n})})]})]})}function N(){return(0,l.jsx)("div",{style:{height:"100vh"},children:(0,l.jsx)(H,{})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[658,441,517,358],()=>t(8521)),_N_E=e.O()}]);